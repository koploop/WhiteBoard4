# 白板软件需求文档

## V0.0.1
### 画板背景
- 支持配置网格背景、纯色背景、自定义图片背景
- 背景支持缩放、拖动

### 画板工具栏
- 支持选择画笔类型（钢笔、铅笔、马克笔）
- 支持选择画笔颜色
- 支持选择画笔粗细
- 支持撤销、重做操作
- 支持清空画板
- 支持切换为选中模式，此时可以圈选元素

### 画板设置栏
- 支持开启和关闭多指模式
- 支持切换背景（网格背景、纯色背景、自定义图片背景）
- 支持开关画布缩放/拖动(画布缩放/拖动和多指模式互斥)

### 划线
- 支持单个手指移动时进行划线操作
- 支持多个手指同时移动时进行划线操作

## V0.0.2

### 元素操作
- 支持删除选中元素
- 支持复制选中元素
- 支持粘贴元素
- 支持改变元素位置
- 支持改变元素大小
- 支持改变元素旋转角度
- 支持改变元素层级（ Bring to Front / Send to Back ）

## V0.0.3
- 支持硬件加速（使用SurfaceView实现）
- 支持元素擦除（切换到橡皮擦模式后，可以使用橡皮擦擦除元素，需要支持元素的拆分擦除）

## V0.0.4
- 支持打包出一个SDK给开发者使用（如WhiteBoard.aar），开发者只需要创建宿主窗口（activity），添加SDK提供的画布（surfaceView），添加功能按钮，就可以在自己的应用中集成白板功能
- 调整目录结构进行一次微重构：
    - app模块：包含UI相关内容，例如画板菜单、功能按钮等
    - boardinterface模块：包含白板SDK的接口，例如切换到选中模式、添加文本元素、添加图片元素等
    - boardimpl模块：包含白板SDK的实现，管理元素、操作元素等逻辑
    - boardpersist模块：白板的持久化模块，例如保存到文件、从文件加载等
    - boardelement模块：包含底层支持插入的各种画板元素，例如文本元素、图片元素、线条元素等

## V0.0.5
- 支持对画板元素选中后，可以进行缩放、旋转、改变颜色（线条元素、文本元素）
    - 选中框：选中元素后，会出现一个矩形框，框住选中的元素，用户可以拖动选中框来改变元素的位置，也可以拖动选中框的角点来改变元素的大小。
    - 选中框的上方有一个旋转按钮，用户可以拖动旋转按钮来改变元素的旋转角度。
    - 选中框的下方有一个菜单按钮，包含：颜色选择器（用户可以点击颜色选择器来选择元素的颜色）、删除按钮（用户可以点击删除按钮来删除选中的元素）、复制按钮（用户可以点击复制按钮来复制选中的元素）、改变层级按钮（用户可以点击改变层级按钮来改变元素的层级）。
- 代码设计要求：
    - 画板元素初始化时支持通过添加能力的方式来决定自己需要支持哪些选中后的操作（addSelectedAbility）, 例如：addSelectedAbility(SelectedAbility.SCALE) 表示支持缩放操作。解耦选中的操作，避免元素重复实现。
    - 选中后的操作如移动、缩放、旋转、改变颜色等通用操作,由一个专有的类如SelectedHandler处理。
    - 选中后对元素的操作，也需要能实时回调给当前元素（如移动/缩放的值、矩阵信息等）, 例如：用户拖动选中框来改变元素的位置时, 元素需要实时收到回调, 进行一些自定义的操作。

## V0.0.6
- 将选择模式的框选改为圈选：
    - 圈选的线条路径根据触摸点位置显示，路径形成的闭合图形经过画板元素即为选中的元素。

## V0.0.7
- 将工具栏ToolBar中btnCircle改为画布缩放按钮，删除设置菜单中的多指书写开关设置
    - 初始状态下，画布缩放按钮为开启状态，可以双指对画布进行移动和缩放那个。此时不支持多指书写。
    - 点击画布缩放按钮切换为关闭状态时，支持多指书写
- 画布需要支持无限画布，即用户可以在任何位置进行移动和缩放，而不会受到画布边界的限制。

## V0.0.8
- 优化代码设计，使用并行状态机模式管理画布的状态转换，包括：画笔状态、选中状态、擦除状态、多指状态（后续实现，即根据多点触控时候触摸点面积不同来决定每个触摸要执行书写、移动、还是橡皮擦）。

## V0.0.9
- 支持多指书写时，每个手指可以独立实现不同的功能
    - 根据触摸点面积（touchMajor）判断是书写笔、手指触摸、橡皮擦。
    - 计算方法使用HikDefaultTouchCalc类的getTouchType方法
    - 类型是笔时即划线操作，类型是手指触摸时即移动元素操作，类型是橡皮擦时即擦除元素操作。

## V0.1.0
- 实现插入图片元素（更多工具中点击插入图片，从本地文件/相册选择图片插入到白板上）
    - 图片元素支持的选中能力：移动、缩放、旋转、改变层级


## V0.1.1
- 增加容器类元素，从此版本开始，将白板元素类型进行区分：
    - 线条元素：StrokeElement, ShapeElement(通过点的集合来绘制)
    - 非容器类普通元素：TextElement（不支持内部操作）
    - 容器类元素：MindMapElement(思维导图), ImageElement(图片元素)等，需要在元素内部也支持划线、擦除的元素。
- 图片元素修改为容器类元素： 
    - 非选中状态下，支持在图片元素内部绘制线条（起点在图片元素内部，终点可以在图片元素外部），选中状态下拖动保持为移动操作
    - 选中图片即选中图片和它内部的线条（图片被视为了一个容器ViewGroup）
    - 内部的线条同样支持橡皮擦擦除