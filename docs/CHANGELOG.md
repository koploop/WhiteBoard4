# 更新日志

本项目的所有重要更改都将记录在此文件中。


## [0.1.5] - 2026-02-04

### 新增
- **手掌橡皮擦 (Hand Eraser)**:
    - 实现了基于触摸面积的智能识别功能（RDV0.0.9）：
    - 在书写模式下，当检测到大面积触摸（如手掌、拳头）时，自动切换为橡皮擦模式。
    - 橡皮擦大小动态跟随触摸面积。
    - 实现了橡皮擦大小随移动速度动态调整：移动越快，擦除范围越大；速度降低后恢复初始大小。
    - 保持了模式隔离：该智能检测仅在书写模式下生效，不影响原有的橡皮擦模式和圈选模式。

## [0.1.4] - 2026-02-04

### 变更
- **引入并行状态机 (Parallel State Machine)**:
    - 重构了画布交互逻辑，采用并行状态机模式替代原有的单一模式判断。
    - 新增 `boardstate` 模块，将不同交互行为（绘图、选中、擦除、导航）封装为独立的状态类。
    - 实现了 `CanvasStateMachine`，支持多个并行状态区域（工具区、导航区），为未来的复杂多指交互奠定了基础。
    - 重构了 `TouchHandler`，使其成为状态机的分发器，代码结构更加清晰，易于扩展。
    - 升级了 `IWhiteBoardSDK` 接口，暴露了更多原子操作（如 `addElement`, `eraseAt` 等），增强了 SDK 的灵活性。

## [0.1.3] - 2026-02-04

### 变更
- **升级 minSdk 至 29**:
    - 将所有模块的 `minSdk` 从 28 提升至 29。
    - 优化了触控坐标获取逻辑：利用 Android API 29 引入的 `getRawX(index)` 和 `getRawY(index)` 直接获取多指原始坐标，移除了之前的偏移量计算方案。

### 修复
- **修复加速画布笔迹偏移及粗细不一致问题**:
    - 解决了当画布平移或缩放后，实时书写笔迹在加速画布（硬件加速层）与真实画布上位置不一致的问题。
    - 修复了画布缩放后加速笔迹与逻辑笔迹粗细不一致的问题：在加速层绘制时，将 `canvasScale` 应用于 `strokeWidth`。
    - 修改了 `TouchHandler` 的坐标处理逻辑：对于加速画布的绘制，改用原始坐标 (`rawX`, `rawY`)，而不再受画布偏移和缩放的影响。
    - 增加了对多指书写场景下原始坐标的追踪与清理逻辑。

## [0.1.2] - 2026-02-03

### 变更
- **性能优化：空间索引 (QuadTree)**:
    - 引入了 `QuadTree` 空间索引算法，显著提升了在密集笔迹场景下的元素检索效率。
    - 优化了橡皮擦碰撞检测逻辑，由全量遍历改为区域查询，大幅降低计算开销。
- **性能优化：路径简化 (RDP)**:
    - 实现了 Ramer-Douglas-Peucker (RDP) 路径简化算法。
    - 在 `StrokeElement` 中增加了 `isSimplificationEnabled` 配置项（默认开启），有效减少冗余点数，提升渲染性能。
- **性能优化：渲染架构升级**:
    - 实现了 **静态层缓存 (Static Layer Cache)**：使用 `Picture` 录制不常变动的元素，加速缩放和平移操作。
    - 引入了 `structuralVersion` 机制，精准控制缓存重绘时机（仅在元素增删改或选中态切换时更新）。
    - 优化了渲染循环：消除了每一帧的 `sortedBy` 排序操作，改用预排序列表。
    - 优化了笔迹绘制：移除了 `draw` 过程中的 `paint.reset()`，减少 CPU 开销。

## [0.1.1] - 2026-02-03

### 变更
- 修改了选中框菜单中“复制”按钮的功能：
    - 由原来的复制到剪贴板改为直接在当前画板复制并粘贴。
    - 复制出的新元素自动向右下方偏移 50 像素。
    - 复制完成后，选中框自动切换到新生成的元素上。


## [0.1.0] - 2026-02-03

### 新增
- 实现了圈选功能 (Lasso Selection)，支持自由路径选择元素。
- 实现了无限画布功能，支持无限制的平移和缩放。

### 变更
- 更新了工具栏：将 `btnCircle` 替换为 `btnZoom` (画布缩放/平移切换)。
- 优化了交互逻辑：缩放/平移不再是独立模式，而是与其他模式共存。
- 精细化手势识别：
    - 实现了缩放与移动的互斥：单次操作仅执行缩放或移动其中之一。
    - 引入起始阈值：减少由于轻微颤抖导致的误触发。
    - 增加“同时按下”判断：避免在单指书写过程中由于第二指落下误入画布变换模式。
- 调整了多指冲突：开启缩放时禁用多指书写，关闭时启用；非书写模式下仅处理首指事件。
- 简化了设置面板：移除了多指书写开关，改由工具栏按钮控制。

### 修复
- 修复了书写模式下第二根手指落下导致第一根手指书写中断的问题。现在只有在满足双指缩放触发条件时，才会中断书写并进入画布变换模式。

## [0.0.9] - 2026-02-02

### 变更
- 优化了 "更多工具" 面板中每个项目的布局。
- 图标大小调整为 24dp。
- 标题文字大小调整为 8sp，并支持两行显示。
- 确保图标与文字水平居中对齐。

## [0.0.8] - 2026-02-02

### 变更
- 调整 "更多工具" 面板宽度为 401dp。
- 调整工具列表项高度为 36dp。
- 优化了面板高度计算逻辑，支持 `wrap_content` 自适应。

## [0.0.7] - 2026-02-02

### 新增
- 实现了 "更多工具" 面板。
- 支持 4 列可独立滚动的工具列表。
- 工具列表支持通过 `ToolData.kt` 进行动态配置。
- 实现了点击外部自动关闭面板的交互。

## [0.0.6] - 2026-02-02

### 变更
- 将菜单栏 Toolbar 和设置面板独立为自定义 View 组件。
- 重构 `activity_main.xml`，使用新组件简化布局结构。
- 更新点击逻辑：`btnMenu` 触发设置面板，`btnSettings` 触发画笔设置提示。

## [0.0.5] - 2026-02-02

### 变更
- 根据设计稿重构了 Android 原生菜单栏 `activity_main.xml`。
- 采用分段式悬浮设计，分为左、中、右三个功能区。
- 为所有工具按钮创建并集成了内置的 Vector Drawable 图标。
- 优化了菜单栏的视觉风格，采用深色主题和圆角阴影效果。

## [0.0.4] - 2026-01-31

### 新增
- 创建了用于 SDK 接口的 `boardinterface` 模块。
- 创建了用于核心元素模型的 `boardelement` 模块。
- 创建了用于 SDK 实现和 SurfaceView 的 `boardimpl` 模块。
- 创建了用于未来持久化支持的 `boardpersist` 模块。
- 定义了用于外部集成的 `IWhiteBoardSDK` 接口。

### 变更
- 将项目结构重构为模块化架构.
- 将元素模型移至 `boardelement` 模块并更新了包名。
- 将 `WhiteBoardViewModel` 逻辑移至 `boardimpl` 模块中的 `WhiteBoardSDKImpl`。
- 将 `WhiteBoardSurfaceView` 和 `TouchHandler` 移至 `boardimpl` 模块。
- 更新 `app` 模块以使用新的 SDK 模块。
- 更新 `MainActivity`，通过 `IWhiteBoardSDK` 与白板交互。

## [0.0.3] - 2026-01-28

### 新增
- 使用 `SurfaceView` 实现硬件加速。
- 带有元素拆分逻辑的橡皮擦工具。
- 使用 `accelerate` 模块实现低延迟绘图。
- 多元素套索选择。
- 选中元素的成组移动。

## [0.0.2] - 2026-01-25

### 新增
- 支持文本元素。
- 支持图像元素。
- 元素变换（移动、缩放、旋转）。
- 层级管理（置于顶层、置于底层）。
- 复制和粘贴功能。

## [0.0.1] - 2026-01-20

### 新增
- 初始项目设置。
- 基础绘图工具（钢笔、铅笔、记号笔）。
- 背景设置（网格、纯色、图像）。
- 撤销和重做功能。
