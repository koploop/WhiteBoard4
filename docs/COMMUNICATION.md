# 对话记录

本项目的所有历史对话记录都将记录在此文件中。

## 2026-02-04
- 实现 V0.0.8 版本的并行状态机架构：
    - 创建了独立的 `boardstate` 模块，用于解耦交互逻辑。
    - 引入了 `CanvasStateMachine` 并行状态机，通过 Orthogonal Regions（正交区域）管理 `TOOL`（工具）和 `NAVIGATION`（导航）状态。
    - 实现了 `PenState`, `SelectionState`, `EraserState`, `ZoomPanState` 等具体状态。
    - 重构了 `TouchHandler`，将其职责转变为状态机上下文和分发器。
    - 升级了 `IWhiteBoardSDK` 接口，暴露了 `addElement`, `eraseAt`, `selectElement` 等原子操作。
    - 优化了渲染流程：`WhiteBoardSurfaceView` 不再处理具体的绘制细节，而是统一委托给 `TouchHandler.draw()` 进行状态感知的绘制。
- 修复加速画布笔迹同步问题：
    - 分析并定位了画布平移/缩放后，加速层笔迹与逻辑层笔迹位置不重合的原因（加速画布是屏幕坐标系且不随白板移动）。
    - 重构了 `TouchHandler` 的 `handleDrawEvent`，引入 `lastRawPoints` 追踪原始触控坐标。
    - 确保加速画布绘制使用 `rawX` 和 `rawY`，而逻辑路径存储依然使用世界坐标系，实现了两者的完美同步。
    - 修复了缩放后加速笔迹粗细不正确的问题：绘制加速笔迹时，将基础粗细乘以当前画布缩放比例 (`canvasScale`)。
- 升级项目 SDK 版本：
    - 将全局 `minSdk` 提升至 29。
    - 使用原生 `getRawX(index)` / `getRawY(index)` 替换了原有的手动偏移量坐标计算逻辑，代码更加简洁高效。

## 2026-02-03
- 实现V0.0.6和V0.0.7的需求，编码完成进行编译安装验证。
- 将选择模式的框选改为圈选 (Lasso Selection)。
- 工具栏更新：将 `btnCircle` 替换为画布缩放按钮 (`btnZoom`)，移除设置菜单中的多指书写开关。
- 修正并优化缩放/平移逻辑：
    - 缩放/平移不再是独立模式，双指操作触发缩放平移，单指操作保持当前模式功能。
    - 实现缩放与移动的互斥：同一次手势中仅执行缩放或移动，避免两者干扰。
    - 增加“同时按下”判断（100ms阈值）和起始移动阈值，显著降低误触概率。
- 修复 Bug：开启缩放后，第一指书写时落下的第二指不会中断第一指的笔迹。
- 实现缩放/平移模式与多指书写模式的互斥逻辑。
- 支持无限画布，取消画布边界限制。
- 修改选中框菜单中的复制按钮功能：由复制到剪贴板改为直接在当前画板复制并粘贴，偏移 50 像素并自动选中新元素。
- git commit本次修改
- 性能问题分析与优化：当画板上书写的内容非常密集内容很多时，存在性能问题： 
 1. 书写笔迹会变的卡顿 
 2. 画板的缩放、移动几乎变的不可用，非常卡顿 
 3. 橡皮擦擦除几乎不可用，非常卡顿 
 给出原因分析和解决方案
- 路径简化这一步在StrokeElement中通过属性配置成可选项，默认启用，也可以不启用。

## 2026-02-02
- 根据设计稿图片，修改白板菜单栏ToolBar实现，对于没有提供的icon资源，可以使用占位图或者生成类似的icon。
- 运行安装到当前连接设备。
- 菜单栏高度改为40dp。
- 菜单栏toolbar、设置面板应该从activity布局中独立出来，修改为一个单独的view，添加到布局中。
- 设置面板的触发是由按钮@+id/btnMenu点击触发，按钮@+id/btnSettings触发的是画笔设置。
- 实现一个更多工具列表的页面：独立页面实现，点击更多工具按钮弹出，点击空白处关闭；支持动态配置数据源；列表每一列支持上下滚动。
- 修改更多工具面板尺寸：宽度 401dp，item 高度 36dp，面板高度根据内容自适应。
- 调整每个 item 的布局：左侧图标 24dp 居中，右侧文字 8sp 支持两行，整体居中对齐。

## 2026-01-31
- 进行一次微重构，具体需求参考RequestDoc.md文档的V0.04版本需求。并且更新设计文档（WhiteBoard.md）, 同时本次修改内容更新到CHANGELOG.md
- 执行编译安装验证

